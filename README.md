nablarch-example-web
===========================

Nablarchアプリケーションフレームワークを利用して作成したウェブExampleアプリケーションです。

## 機能一覧

以下に本Exampleが実装している機能一覧を示します。

| 機能分類 | 機能分類説明 | 機能名 | 機能説明 | 備考 |
|:--------|:-------------------------------------|:---------------------|:--------------------------------------------------------------------------------|:----------------------------------------|
| 認証 | プロジェクト管理システムへの認証機能を提供する。 | 認証 | ユーザに対し、ユーザID・パスワードでのForm認証を行う。<br>ログイン中のユーザをログアウトさせる。 | ユーザには、以下２つのロールが存在する。<br>・管理者<br>・一般ユーザー |
| 共通 | プロジェクトで共通的に使用する機能を提供する。 | TOPメニュー | ログイン中のユーザが選択可能なメニュー一覧を表示する。<br>全ての画面の上部に部品として配置されている。 |  |
|  |  | 汎用エラー | 画面上で発生したエラーについてその内容と対処方法をユーザに表示する。 | エラー内容単位にメッセージを変更する。(画面ごとに変更している) |
| プロジェクト管理 | プロジェクトを管理対象として登録し、そのデータの更新や参照、削除を行う。 | プロジェクト登録 | 管理対象とするプロジェクトのデータ1件を登録する。 |  |
|  |  | プロジェクト検索 | プロジェクトの検索条件を入力し、検索条件に該当するプロジェクトの一覧を表示する。<br>一覧のリンクを押下するとプロジェクトのデータ1件の詳細画面を表示する。 |  |
|  |  | プロジェクト更新 | 管理対象とするプロジェクトのデータ1件を更新する。 |  |
|  |  | プロジェクト削除 | 管理対象とするプロジェクトのデータ1件を削除する。 |  |
|  |  | プロジェクト検索結果ダウンロード | プロジェクトの検索条件を入力し、検索条件に該当するプロジェクトの一覧をCSVファイルとして出力する。 ||
|  |  | プロジェクト一括更新 | プロジェクトの検索条件を入力し、検索条件に該当するプロジェクトのデータを一括更新する。 |  |
|  |  | プロジェクトファイルアップロード一括登録 | CSVファイルを入力値とし、プロジェクトのデータを一括登録する。 | 管理者のみ使用できる。 |

詳細については、解説書の [Getting Started](https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/web/getting_started/index.html) を参照してください。



## 実行手順

### 1.動作環境
実行環境に以下のソフトウェアがインストールされている事を前提とします。
* Java Version : 17
* Maven 3.9.9以降

以下は、本手順では事前準備不要です。

|ソフトウェア|説明|
|:---|:---|
|APサーバ|このアプリケーションはJetty 12を使用しています。jetty-ee10-maven-pluginはJetty 12へのアプリケーションのデプロイ、起動を行います。|
|DBサーバ|このアプリケーションはH2 Database Engine(以下H2)を組み込んであるため、別途インストールの必要はありません。|

### 2. プロジェクトリポジトリの取得
Gitを使用している場合、アプリケーションを配置したいディレクトリにて「git clone」コマンドを実行してください。
以下、コマンドの例です。

    $mkdir c:\example
    $cd c:\example
    $git clone https://github.com/nablarch/nablarch-example-web.git

Gitを使用しない場合、最新のタグからzipをダウンロードし、任意のディレクトリへ展開してください。


### 3. アプリケーションのビルドと起動
jetty-ee10-maven-pluginを実行して、アプリケーションのビルドとJetty 12の起動を行います。以下のコマンドを実行してください。

    $cd nablarch-example-web
    $mvn jetty:run

起動に成功したら、ブラウザで http://localhost:8080/ を開いてください。ログイン画面が表示されます。
以下のログインID、パスワードでログインできます。

| ログインID | パスワード | ロール     |
|:-----------|:-----------|:-----------|
| 10000001   | pass123-   | 管理者     |
| 10000002   | pass123-   | 一般ユーザ |

※プロジェクトの一括アップロード機能は、管理者ロールを持つユーザだけが使用できます。

#### コマンドの補足
本Exampleアプリケーションを起動するまでに必要な手順は以下になります。

1. データベースのセットアップ及びエンティティクラスの作成
1. アプリケーションのビルド
1. Jetty 12の起動

これらの手順はJetty 12を起動する`jetty:run`を実行する際にすべて含まれていますが、個別に実行することもできます。

##### データベースのセットアップ及びエンティティクラスの作成

以下のコマンドを実行することでデータベースのセットアップ及びエンティティクラスの作成を行うことができます。

    $mvn generate-resources

※gspプラグインをJava 17で実行するためにはJVMオプションの指定が必要ですが、そのオプションは`.mvn/jvm.config`で指定しています。

##### アプリケーションのビルド

以下のコマンドを実行することでアプリケーションのビルドを行うことができます。

    $mvn compile

※`compile`を実行するとデータベースのセットアップ及びエンティティクラスの作成処理も行われます。

### 4. DBの確認方法

1. https://www.h2database.com/html/download.html からH2をインストールしてください。  


2. {インストールフォルダ}/bin/h2.bat を実行してください(コマンドプロンプトが開く)。  
  ※h2.bat実行中はExampleアプリケーションからDBへアクセスすることができないため、Exampleアプリケーションを停止しておいてください。

3. ブラウザから http://localhost:8082 を開き、以下の情報でH2コンソールにログインしてください。
   JDBC URLの{dbファイルのパス}には、`nablarch_example.mv.db`ファイルの格納ディレクトリまでのパスを指定してください。  
  JDBC URL：jdbc:h2:{dbファイルのパス}/nablarch_example  
  ユーザ名：NABLARCH_EXAMPLE  
  パスワード：NABLARCH_EXAMPLE

